(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2905:(e,t,l)=>{Promise.resolve().then(l.bind(l,5920))},5920:(e,t,l)=>{"use strict";l.d(t,{LostItemMap:()=>u});var r=l(5155),s=l(2115),o=l(9101),n=l.n(o);function a(e){let{onSubmit:t,onCancel:l,selectedLocation:o}=e,[n,a]=(0,s.useState)({title:"",description:"",category:"その他",contactInfo:""});return(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),o&&t({...n,location:{lat:o[1],lng:o[0]},foundAt:new Date().toISOString(),status:"未返却"})},className:"space-y-4 p-4 bg-white rounded-lg shadow",children:[!o&&(0,r.jsx)("div",{className:"p-2 bg-yellow-50 border border-yellow-200 rounded-md text-yellow-800",children:"マップ上で落とし物を発見した場所をクリックしてください"}),o&&(0,r.jsxs)("div",{className:"p-2 bg-green-50 border border-green-200 rounded-md text-green-800",children:["位置が選択されました: ",o[1].toFixed(6),", ",o[0].toFixed(6)]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"タイトル"}),(0,r.jsx)("input",{type:"text",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",value:n.title,onChange:e=>a({...n,title:e.target.value})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"説明"}),(0,r.jsx)("textarea",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",value:n.description,onChange:e=>a({...n,description:e.target.value})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"カテゴリー"}),(0,r.jsxs)("select",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",value:n.category,onChange:e=>a({...n,category:e.target.value}),children:[(0,r.jsx)("option",{value:"財布",children:"財布"}),(0,r.jsx)("option",{value:"カバン",children:"カバン"}),(0,r.jsx)("option",{value:"電子機器",children:"電子機器"}),(0,r.jsx)("option",{value:"その他",children:"その他"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"連絡先"}),(0,r.jsx)("input",{type:"text",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",value:n.contactInfo,onChange:e=>a({...n,contactInfo:e.target.value})})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,r.jsx)("button",{type:"button",onClick:l,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"キャンセル"}),(0,r.jsx)("button",{type:"submit",disabled:!o,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"投稿"})]})]})}function c(e){let{items:t,onSearch:l}=e,[o,n]=(0,s.useState)(""),[a,c]=(0,s.useState)("すべて"),d=e=>{n(e),l(t.filter(t=>{let l=t.title.toLowerCase().includes(e.toLowerCase())||t.description.toLowerCase().includes(e.toLowerCase()),r="すべて"===a||t.category===a;return l&&r}))},u=e=>{c(e),l(t.filter(t=>{let l=t.title.toLowerCase().includes(o.toLowerCase())||t.description.toLowerCase().includes(o.toLowerCase()),r="すべて"===e||t.category===e;return l&&r}))};return(0,r.jsxs)("div",{className:"space-y-4 p-4 bg-white rounded-lg shadow",children:[(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"text",placeholder:"落とし物を検索...",className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:o,onChange:e=>d(e.target.value)})}),(0,r.jsx)("div",{children:(0,r.jsxs)("select",{className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:a,onChange:e=>u(e.target.value),children:[(0,r.jsx)("option",{value:"すべて",children:"すべてのカテゴリー"}),(0,r.jsx)("option",{value:"財布",children:"財布"}),(0,r.jsx)("option",{value:"カバン",children:"カバン"}),(0,r.jsx)("option",{value:"電子機器",children:"電子機器"}),(0,r.jsx)("option",{value:"その他",children:"その他"})]})})]})}l(6467);let d="lost-items";function u(e){let{center:t=[139.767,35.6814],zoom:l=13}=e,o=(0,s.useRef)(null),u=(0,s.useRef)(null),[i,m]=(0,s.useState)(()=>{let e=localStorage.getItem(d);return e?JSON.parse(e):[]}),[x,b]=(0,s.useState)([]),[g,h]=(0,s.useState)(!1),[f,p]=(0,s.useState)(null),[v,j]=(0,s.useState)(null);return(0,s.useEffect)(()=>{b(i)},[i]),(0,s.useEffect)(()=>{localStorage.setItem(d,JSON.stringify(i))},[i]),(0,s.useEffect)(()=>{if(o.current)return u.current=new(n()).Map({container:o.current,style:"https://demotiles.maplibre.org/style.json",center:t,zoom:l}),u.current.on("click",e=>{if(g){let t=[e.lngLat.lng,e.lngLat.lat];p(t),v&&v.remove(),j(new(n()).Marker({color:"#3B82F6"}).setLngLat(t).addTo(u.current))}}),()=>{var e;v&&v.remove(),null==(e=u.current)||e.remove()}},[t,l,g,v]),(0,s.useEffect)(()=>{if(!u.current)return;let e=document.getElementsByClassName("maplibregl-marker");for(;e[0];)e[0].remove();x.forEach(e=>{let t=new(n()).Popup({offset:25}).setHTML('\n        <div class="p-2">\n          <h3 class="font-bold">'.concat(e.title,"</h3>\n          <p>").concat(e.description,'</p>\n          <p class="text-sm text-gray-600">カテゴリー: ').concat(e.category,'</p>\n          <p class="text-sm text-gray-600">発見日時: ').concat(new Date(e.foundAt).toLocaleString(),'</p>\n          <p class="text-sm text-gray-600">連絡先: ').concat(e.contactInfo,"</p>\n        </div>\n      ")),l=new(n()).Marker({color:"#3B82F6"}).setLngLat([e.location.lng,e.location.lat]).setPopup(t);u.current&&l.addTo(u.current)})},[x]),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"w-full h-[600px] rounded-lg overflow-hidden",children:(0,r.jsx)("div",{ref:o,className:"w-full h-full"})}),(0,r.jsx)("div",{className:"absolute top-4 right-4 z-10",children:(0,r.jsx)("button",{onClick:()=>h(!g),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:g?"キャンセル":"落とし物を投稿"})}),(0,r.jsx)("div",{className:"absolute top-4 left-4 z-10 w-96",children:(0,r.jsx)(c,{items:i,onSearch:b})}),g&&(0,r.jsx)("div",{className:"absolute top-32 left-4 z-10 w-96",children:(0,r.jsx)(a,{onSubmit:e=>{f&&(m([...i,{...e,id:Math.random().toString(36).substr(2,9),location:{lat:f[1],lng:f[0]}}]),h(!1),p(null),v&&(v.remove(),j(null)))},onCancel:()=>{h(!1),p(null),v&&(v.remove(),j(null))},selectedLocation:f})}),g&&!f&&(0,r.jsx)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-white p-2 rounded-md shadow-md",children:"マップ上で落とし物を発見した場所をクリックしてください"})]})}},6467:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[466,600,441,684,358],()=>t(2905)),_N_E=e.O()}]);